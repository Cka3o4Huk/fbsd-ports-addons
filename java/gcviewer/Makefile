# Created by: Michael Zhilin <mizhka@gmail.com>
# $FreeBSD$

PORTNAME=	GCViewer
PORTVERSION=	1.34
CATEGORIES=	java devel
MASTER_SITES=	GH

MAINTAINER=	mizhka@gmail.com
COMMENT=	Tool to visualizes verbose GC output generated by JVM

LICENSE=	LGPL21

BUILD_DEPENDS=	${LOCALBASE}/share/java/maven31/bin/mvn:${PORTSDIR}/devel/maven31

USE_GITHUB=	yes
GH_ACCOUNT=	chewiebug
GH_PROJECT=	${PORTNAME}
GH_TAGNAME=	${PORTVERSION}
GH_COMMIT=	9976ade

USE_JAVA=	YES
JAVA_OS=	native
JAVA_VERSION=	1.7+
JAVA_VENDOR=	openjdk
JAVA_BUILD=	yes
JAVA_RUN=	yes

MVN_LOCAL_REPO=	-Dmaven.repo.local=${WRKDIR}/${PORTNAME}-maven-repo-${PORTVERSION}/repository
MVN_TEST_FLAG=	-Dmaven.test.skip=true

SUB_FILES=	${PORTNAME}.sh

PLIST_FILES+=	%%JAVAJARDIR%%/gcviewer.jar bin/${PORTNAME}

post-extract:
	@(cd ${WRKSRC}; ${SETENV} JAVA_HOME=${JAVA_HOME} M2_HOME=${LOCALBASE}/share/java/maven31 ${MVN_OPTS} \
		mvn ${MVN_LOCAL_REPO} dependency:go-offline)
    
do-build:
	@(cd ${WRKSRC}; ${SETENV} JAVA_HOME=${JAVA_HOME} M2_HOME=${LOCALBASE}/share/java/maven31 ${MVN_OPTS} \
		mvn ${MVN_TEST_FLAG} ${MVN_LOCAL_REPO} -o clean verify)

do-install:
	${INSTALL_SCRIPT} ${WRKDIR}/${PORTNAME}.sh ${STAGEDIR}/${PREFIX}/bin/${PORTNAME}
	${INSTALL_DATA} ${INSTALL_WRKSRC}/target/gcviewer-${PORTVERSION}.jar \
		 ${STAGEDIR}${JAVAJARDIR}/gcviewer.jar

.include <bsd.port.mk>
